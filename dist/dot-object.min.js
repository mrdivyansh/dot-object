!function(t,r){"use strict";function e(t,r){var e,i;if("function"==typeof r)void 0!==(i=r(t))&&(t=i);else if(Array.isArray(r))for(e=0;e<r.length;e++)void 0!==(i=r[e](t))&&(t=i);return t}function i(t){return"[object Object]"===Object.prototype.toString.call(t)}function n(t){return Object(t)===t}function o(t){return 0===Object.keys(t).length}function s(t,r){return t.indexOf("[")>=0&&(t=t.replace(/\[/g,".").replace(/]/g,"")),t.split(r)}function f(t,r,e){if(!(this instanceof f))return new f(t,r,e);void 0===r&&(r=!1),void 0===e&&(e=!0),this.separator=t||".",this.override=r,this.useArray=e,this.keepArray=!1,this.cleanup=[]}var p=new f(".",!1,!0);function c(t){return function(){return p[t].apply(p,arguments)}}f.prototype._fill=function(t,r,i,s){var f,p=t.shift();if(t.length>0){if(r[p]=r[p]||(this.useArray&&(f=t[0],/^\d+$/.test(f))?[]:{}),!n(r[p])){if(!this.override){if(!n(i)||!o(i))throw new Error("Trying to redefine `"+p+"` which is a "+typeof r[p]);return}r[p]={}}this._fill(t,r[p],i,s)}else{if(!this.override&&n(r[p])&&!o(r[p])){if(!n(i)||!o(i))throw new Error("Trying to redefine non-empty obj['"+p+"']");return}r[p]=e(i,s)}},f.prototype.object=function(t,r){var i=this;return Object.keys(t).forEach(function(n){var o=void 0===r?null:r[n],f=s(n,i.separator).join(i.separator);-1!==f.indexOf(i.separator)?(i._fill(f.split(i.separator),t,t[n],o),delete t[n]):i.override&&(t[n]=e(t[n],o))}),t},f.prototype.str=function(t,r,i,n){return-1!==t.indexOf(this.separator)?this._fill(t.split(this.separator),i,r,n):i.hasOwnProperty(t)&&!this.override||(i[t]=e(r,n)),i},f.prototype.pick=function(t,r,e){var i,n,o,f,p,c,a;for(n=s(t,this.separator),i=0;i<n.length;i++){if(c=n[i],a=r,f="-"===c[0]&&Array.isArray(a)&&/^-\d+$/.test(c)?a.length+parseInt(c,10):c,!(r&&"object"==typeof r&&f in r))return;if(i===n.length-1)return e?(o=r[f],delete r[f],Array.isArray(r)&&(p=n.slice(0,-1).join("."),-1===this.cleanup.indexOf(p)&&this.cleanup.push(p)),o):r[f];r=r[f]}return e&&Array.isArray(r)&&(r=r.filter(function(t){return void 0!==t})),r},f.prototype.remove=function(t,r){var e;if(this.cleanup=[],Array.isArray(t)){for(e=0;e<t.length;e++)this.pick(t[e],r,!0);return this._cleanup(r),r}return this.pick(t,r,!0)},f.prototype._cleanup=function(t){var r,e,i,n;if(this.cleanup.length){for(e=0;e<this.cleanup.length;e++)r=(r=(n=(i=this.cleanup[e].split(".")).splice(0,-1).join("."))?this.pick(n,t):t)[i[0]].filter(function(t){return void 0!==t}),this.set(this.cleanup[e],r,t);this.cleanup=[]}},f.prototype.del=f.prototype.remove,f.prototype.move=function(t,r,i,n,o){return"function"==typeof n||Array.isArray(n)?this.set(r,e(this.pick(t,i,!0),n),i,o):(o=n,this.set(r,this.pick(t,i,!0),i,o)),i},f.prototype.transfer=function(t,r,i,n,o,s){return"function"==typeof o||Array.isArray(o)?this.set(r,e(this.pick(t,i,!0),o),n,s):(s=o,this.set(r,this.pick(t,i,!0),n,s)),n},f.prototype.copy=function(t,r,i,n,o,s){return"function"==typeof o||Array.isArray(o)?this.set(r,e(JSON.parse(JSON.stringify(this.pick(t,i,!1))),o),n,s):(s=o,this.set(r,this.pick(t,i,!1),n,s)),n},f.prototype.set=function(t,r,e,n){var o,f,p,c;if(void 0===r)return e;for(p=s(t,this.separator),o=0;o<p.length;o++){if(c=p[o],o===p.length-1)if(n&&i(r)&&i(e[c]))for(f in r)r.hasOwnProperty(f)&&(e[c][f]=r[f]);else if(n&&Array.isArray(e[c])&&Array.isArray(r))for(var a=0;a<r.length;a++)e[p[o]].push(r[a]);else e[c]=r;else e.hasOwnProperty(c)&&(i(e[c])||Array.isArray(e[c]))||(/^\d+$/.test(p[o+1])?e[c]=[]:e[c]={});e=e[c]}return e},f.prototype.transform=function(t,r,e){return r=r||{},e=e||{},Object.keys(t).forEach(function(i){this.set(t[i],this.pick(i,r),e)}.bind(this)),e},f.prototype.dot=function(t,r,e){return r=r||{},e=e||[],Object.keys(t).forEach(function(s){if(n(t[s])&&(i(t[s])&&!o(t[s])||Array.isArray(t[s])&&!this.keepArray&&0!==t[s].length))return this.dot(t[s],r,e.concat(s));r[e.concat(s).join(this.separator)]=t[s]}.bind(this)),r},f.pick=c("pick"),f.move=c("move"),f.transfer=c("transfer"),f.transform=c("transform"),f.copy=c("copy"),f.object=c("object"),f.str=c("str"),f.set=c("set"),f.del=f.remove=c("remove"),f.dot=c("dot"),["override","overwrite"].forEach(function(t){Object.defineProperty(f,t,{get:function(){return p.override},set:function(t){p.override=!!t}})}),["useArray","keepArray"].forEach(function(t){Object.defineProperty(f,t,{get:function(){return p[t]},set:function(r){p[t]=r}})}),f._process=e,"function"==typeof define&&define.amd?define(function(){return f}):"undefined"!=typeof module&&module.exports?module.exports=f:t.DotObject=f}(this);